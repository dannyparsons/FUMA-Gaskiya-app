{"version":3,"sources":["../../src/pages/essai/traitement/modifier-traitement/modifier-traitement.module.ts","../../src/pages/essai/traitement/modifier-traitement/modifier-traitement.ts"],"names":[],"mappings":"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","file":"51.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ModifierTraitementPage } from './modifier-traitement';\r\n\r\n@NgModule({\r\n  declarations: [ModifierTraitementPage],\r\n  imports: [IonicPageModule.forChild(ModifierTraitementPage)],\r\n  exports: [ModifierTraitementPage]\r\n})\r\nexport class ModifierTraitementPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/essai/traitement/modifier-traitement/modifier-traitement.module.ts","import { Component } from '@angular/core';\nimport { NavController, NavParams, ToastController, LoadingController, IonicPage } from 'ionic-angular';\nimport { Validators, FormBuilder } from '@angular/forms';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Storage } from '@ionic/storage';\nimport { PouchdbProvider } from '../../../../providers/pouchdb-provider';\n\n/*\n  Generated class for the ModifierTraitement page.\n\n  See http://ionicframework.com/docs/v2/components/#navigation for more info on\n  Ionic pages and navigation.\n*/ \n@IonicPage()\n@Component({\n  selector: 'page-modifier-traitement',\n  templateUrl: 'modifier-traitement.html'\n})\nexport class ModifierTraitementPage {\n\n  traitementForm: any;\n  traitement: any;\n  //ancien_traitement: any;\n  grandTraitement: any;\n  selectedAnnee: any;\n  ancienneAnnee: any;\n  allTraitement: any;\n  annees: any = [];\n  max_NPR: any;\n  max_NPL: any;\n  ancien_code_t: any;\n  ancien_nom_entree: any;\n  ancien_nom_controle: any;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, public loadingCtl: LoadingController, public toastCtl: ToastController, public servicePouchdb: PouchdbProvider, public formBuilder: FormBuilder, public storage: Storage) {\n    \n    this.grandTraitement = this.navParams.data.traitement;\n    this.traitement = this.grandTraitement.data;\n    //this.ancien_traitement = this.grandTraitement;\n\n    let maDate = new Date();\n    for(let i=0; i<=50; i++){\n      this.annees.push(2000 + i)\n    }\n\n    this.selectedAnnee = this.traitement.annee;\n    this.ancienneAnnee = this.traitement.annee;\n    this.ancien_code_t = this.traitement.code_traitement;\n    this.ancien_nom_entree = this.traitement.nom_entree;\n    this.ancien_nom_entree = this.traitement.nom_controle;\n\n    this.traitementForm = this.formBuilder.group({\n     // _id:[''],\n      code_traitement: [this.traitement.code_traitement, Validators.required],\n      annee: [this.traitement.annee, Validators.required],\n      superficie: [this.traitement.superficie, Validators.required],\n      nom_entree: [this.traitement.nom_entree, Validators.required],\n      nom_controle: [this.traitement.nom_controle, Validators.required],\n      max_NPL: [this.traitement.max_NPL, Validators.required],\n      max_NPR: [this.traitement.max_NPR, Validators.required],\n      description_entree: [this.traitement.description_entree],\n      objectif_traitement: [this.traitement.objectif_traitement],\n      today: [this.traitement.today],\n    });\n    \n  }\n\n  ionViewDidEnter() {\n    this.servicePouchdb.getPlageDocs('fuma:traitement','fuma:traitement:\\uffff').then((t) => {\n        this.allTraitement = t;\n\n      }, err => console.log(err));      \n   \n  }\n\n  verifierUniqueNon(traitement){\n    let res = 1;\n    this.allTraitement.forEach((t, index) => {\n      if((traitement.annee !== this.ancienneAnnee )&& (traitement.annee === t.data.annee ) && ((traitement.nom_entree === t.data.nom_entree) || (traitement.code_traitement === t.data.code_traitement))){\n        res = 0;\n      }\n    });\n    return res;\n  }\n\n     modifier(){\n      //  let date = new Date();\n    let traitement = this.traitementForm.value;\n\n    if(this.verifierUniqueNon(traitement) === 0){\n      alert('Le nom et code du traitement doivent être uniques par an!');\n    }else{\n\n    this.traitement.nom_controle = traitement.nom_controle;\n    this.traitement.nom_entree = traitement.nom_entree;\n    this.traitement.code_traitement = traitement.code_traitement;\n    this.traitement.annee = traitement.annee;\n    this.traitement.superficie = traitement.superficie;\n    this.traitement.max_NPL = traitement.max_NPL;\n    this.traitement.max_NPR = traitement.max_NPR;\n    this.traitement.description_entree = traitement.description_entree;\n    this.traitement.objectif_traitement = traitement.objectif_traitement;\n\n    /*if(this.verifierUniqueNon(typeSole, this.grandTypeSole._id) === 0){\n      alert('Le nom du type de sole doit être uniques!');\n    }else{*/\n      this.grandTraitement.data = this.traitement;\n      this.servicePouchdb.updateDoc(this.grandTraitement);\n\n      if(this.ancien_code_t !== this.traitement.code_traitement || this.ancien_nom_entree !== this.traitement.nom_entree || this.ancien_nom_controle !== this.traitement.nom_controle){\n        //alert('dif')\n        this.appliquerChangement(this.grandTraitement, this.traitement.code_traitement);\n      }else{\n        //alert('dif non'+ this.ancien_code_t +'==='+ this.traitement.code_traitement+ ' '+this.ancien_nom_entree +'==='+ this.traitement.nom_entree+ this.ancien_nom_controle +'==='+ this.traitement.nom_controle) \n        this.navCtrl.pop();\n      }\n\n    \n      /*let toast = this.toastCtl.create({\n        message: 'Traitement bien sauvegardée!',\n        position: 'top',\n        duration: 2000\n      });*/\n\n      //this.navCtrl.pop();\n      //toast.present();\n      \n    }\n   // }\n  }\n\n  appliquerChangement(nouveau_traitement, code_traitement){\n    let loading = this.loadingCtl.create({\n      content: 'Modification en cours...'\n    });\n\n    loading.present();\n\n    this.servicePouchdb.getPlageDocsRapide('fuma:essai', 'fuma:essai:\\uffff').then((essai) => {\n      if(essai){\n        essai.map((ess) => {\n          if(ess.doc.data.id_traitement && ess.doc.data.id_traitement === nouveau_traitement._id && ess.doc.data.annee_essai === nouveau_traitement.data.annee){\n            ess.doc.data.code_traitement = nouveau_traitement.data.code_traitement;\n            ess.doc.data.nom_entree = nouveau_traitement.data.nom_entree;\n            ess.doc.data.nom_controle = nouveau_traitement.data.nom_controle;\n            ess.doc.data.id_traitement = nouveau_traitement._id;\n\n            this.servicePouchdb.updateDoc(ess.doc);\n          }\n          else if(ess.doc.data.annee_essai === nouveau_traitement.data.annee && ess.doc.data.code_traitement === code_traitement){\n            ess.doc.data.code_traitement = nouveau_traitement.data.code_traitement;\n            ess.doc.data.nom_entree = nouveau_traitement.data.nom_entree;\n            ess.doc.data.nom_controle = nouveau_traitement.data.nom_controle;\n            ess.doc.data.id_traitement = nouveau_traitement._id;\n\n            this.servicePouchdb.updateDoc(ess.doc);\n          }\n        });\n\n        loading.dismissAll();\n\n      let toast = this.toastCtl.create({\n        message: 'Traitement bien sauvegardée!',\n        position: 'top',\n        duration: 2000\n      });\n\n      toast.present();\n      this.navCtrl.pop();\n      \n      }else{\n        loading.dismissAll();\n      let toast = this.toastCtl.create({\n        message: 'Traitement bien sauvegardée!',\n        position: 'top',\n        duration: 2000\n      });\n\n      toast.present();\n      this.navCtrl.pop();\n      }\n    }, err => {\n      loading.dismissAll();\n      alert('Erreur lors de la tentative de modification du traitement!');\n      this.navCtrl.pop();\n    })\n  }\n\n  annuler(){\n    this.navCtrl.pop();\n  }\n\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/essai/traitement/modifier-traitement/modifier-traitement.ts"],"sourceRoot":""}